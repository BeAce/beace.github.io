{"componentChunkName":"component---src-templates-blog-post-js","path":"/2017-09-23-记一次阿里云服务器ECS迁移导致的nginx和node有关问题/","webpackCompilationHash":"a7e2b21b509852c48099","result":{"data":{"site":{"siteMetadata":{"title":"Beace Blog","author":"Beace Lee"}},"markdownRemark":{"id":"8961d711-a3cf-59a2-acc8-3ed852eb38e8","html":"<p>阿里云的产品提醒还是很友好的，一快到付费节点，那短信提醒简直比移动联通欠话费还来得勤快。</p>\n<p><img src=\"https://beimg.oss-cn-beijing.aliyuncs.com/Aliyun/aliyun-xin.png!ace\"></p>\n<p>不过重要的消息通知还是很及时。近几天部分服务器迁移，虽迁移顺利，但是由于后台为<a href=\"https://nodejs.org/en/\">Node.js</a>起的服务，需要手动重启，下面记录下该过程。</p>\n<!--more-->\n<blockquote>\n<p>以下环境为阿里云ECS, OS: CentOS7。</p>\n</blockquote>\n<ol>\n<li>服务重启，<a href=\"https://nodejs.org/en/\">Node.js</a>更新</li>\n</ol>\n<p>更新nodejs有多种方法，你可以重新下载源文件解压，覆盖之前的，或者通过brew/nvm来更新，我用的最简便的方式，通过npm来更新。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">npm</span> cache clean -f\n$ <span class=\"token function\">npm</span> <span class=\"token function\">install</span> -g n\n$ n stable</code></pre></div>\n<p>很明显，从语义上就可理解，<a href=\"https://github.com/tj/n\">n</a>是<a href=\"https://nodejs.org/en/\">Node.js</a>的版本管理工具，完全没有复杂的多余配置，可以通过其安装不同版本的<a href=\"https://nodejs.org/en/\">Node.js</a>，在这里获取了<a href=\"https://nodejs.org/en/\">Node.js</a>的最新稳定版本。</p>\n<p><img src=\"https://beimg.oss-cn-beijing.aliyuncs.com/Aliyun/node-upgrade.png!ace\"></p>\n<ol>\n<li>安装<a href=\"https://github.com/Unitech/pm2\">GitHub - Unitech/pm2</a>帮助node服务常作用</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">npm</span> <span class=\"token function\">install</span> -g pm2\n$ <span class=\"token function\">cd</span> /path/to/myproject\n$ pm2 <span class=\"token function\">npm</span> start --start</code></pre></div>\n<ol>\n<li>由于node服务不再映射到80端口，nginx自己找到了其默认配置下的conf文件，将网站指向了一个index.html文件中。因此，需要解决端口的占用问题。</li>\n</ol>\n<p>下图是由下面命令重启nginx的报错，明显看到，端口报错。当然，报错信息不会如此全面，需要<code class=\"language-text\">status</code>\n命令去查看详细的报错信息。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ systemctl start nginx.service\n$ systemctl status nginx.service</code></pre></div>\n<p><img src=\"https://beimg.oss-cn-beijing.aliyuncs.com/Aliyun/nginx-address.png!ace\"></p>\n<p>通过以下命令读取占用端口的进程，并杀死他们。居然有这么多。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ fuser -n tcp 80\n$ kill -9 791  1095  1096  1097  1098  1099  1148  1150  1216  1218  1763\n# 再次检查\n$ fuser -n tcp 80\n# 最后重启nginx\n$ systemctl start nginx.service</code></pre></div>\n<p><img src=\"https://beimg.oss-cn-beijing.aliyuncs.com/Aliyun/kill-process.png!ace\"></p>","frontmatter":{"title":"记一次阿里云服务器ECS迁移导致的nginx和node有关问题","date":"September 23, 2017"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2017-09-23-记一次阿里云服务器ECS迁移导致的nginx和node有关问题/","previous":{"fields":{"slug":"/2017-09-19-写给弟弟，玄烨/"},"frontmatter":{"title":"写给弟弟，玄烨"}},"next":{"fields":{"slug":"/2017-10-10-Cascader Format/"},"frontmatter":{"title":"Cascader Format"}}}}}