{"componentChunkName":"component---src-templates-blog-post-js","path":"/scala-palyframework-curd-2/","webpackCompilationHash":"1e3e2b3aceaf2ae073fa","result":{"data":{"site":{"siteMetadata":{"title":"Beace Blog","author":"Beace Lee"}},"markdownRemark":{"id":"be5a5880-4896-56de-b13b-6252dd06a1f6","html":"<h2>需求</h2>\n<ul>\n<li>\n<p>将项目导入IDE（Intellij）</p>\n</li>\n<li>\n<p>理解静态页面与服务器请求发生的原理</p>\n</li>\n<li>\n<p>完成增删改查的静态页面</p>\n</li>\n</ul>\n<!--more-->\n<h2>主要知识点</h2>\n<ul>\n<li>\n<p>项目目录的理解</p>\n</li>\n<li>\n<p>路由配置，请求静态页面的过程</p>\n</li>\n<li>\n<p>页面传参原理</p>\n</li>\n<li>\n<p>静态页面代码书写</p>\n</li>\n</ul>\n<hr>\n<h3>导入IDE</h3>\n<p>导入时不要选择<code class=\"language-text\">Open</code>，选择<code class=\"language-text\">New</code>-><code class=\"language-text\">Project from Existing Sources...</code>，然后选择<code class=\"language-text\">SBT</code>导入。</p>\n<p><img src=\"https://images-manager.oss-cn-shanghai.aliyuncs.com/static/play-scala-userlist/IDE.png\" alt=\"img\"></p>\n<p>导入成功后的项目截图如下：</p>\n<p><img src=\"https://images-manager.oss-cn-shanghai.aliyuncs.com/static/play-scala-userlist/project-sreenshoot.png\" alt=\"img\"></p>\n<h3>目录含义</h3>\n<p><strong>常用的以下文件</strong></p>\n<ul>\n<li>\n<p><code class=\"language-text\">/app</code> 源代码文件，标准的MVC目录结构。</p>\n</li>\n<li>\n<p><code class=\"language-text\">/conf</code>配置文件，包含路由、日志的配置</p>\n</li>\n<li>\n<p><code class=\"language-text\">/lib</code> 库文件</p>\n</li>\n<li>\n<p><code class=\"language-text\">/target</code> 目标代码</p>\n</li>\n<li>\n<p><code class=\"language-text\">/built.sbt</code> 运行环境所用到的库以及驱动配置文件</p>\n</li>\n</ul>\n<h3>路由配置</h3>\n<p>在具体解释路由配置之前，可以先查看一下<code class=\"language-text\">/app/views</code>,这里存放了静态页面（<code class=\"language-text\">.html</code>）文件，尝试修改<code class=\"language-text\">main.scala.html</code>中的代码,将<code class=\"language-text\">main</code>中的字符串随便修改一下，如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre class=\"language-scala\"><code class=\"language-scala\"><span class=\"token annotation punctuation\">@main</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Welcome to Play，hello play 2\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    @<span class=\"token operator\">*</span>\n     <span class=\"token operator\">*</span> Get an `Html` <span class=\"token keyword\">object</span> by calling the built<span class=\"token operator\">-</span>in Play welcome\n     <span class=\"token operator\">*</span> template and passing a `<span class=\"token builtin\">String</span>` message<span class=\"token punctuation\">.</span>\n     <span class=\"token operator\">*</span>@\n    <span class=\"token annotation punctuation\">@play20</span><span class=\"token punctuation\">.</span>welcome<span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span> style <span class=\"token operator\">=</span> <span class=\"token string\">\"Scala\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>回到浏览器刷新页面，可以观察到，<code class=\"language-text\">title</code>发生了变化。恭喜你，到此，说明你的项目是正常的，环境终于搭建完成了。</p>\n<h4>我们来简单浏览下<code class=\"language-text\">/app</code>和<code class=\"language-text\">/conf</code>里面的内容</h4>\n<p>可以看到，最为明显的是<code class=\"language-text\">play</code>的<code class=\"language-text\">MVC</code>结构。<code class=\"language-text\">view</code>中存放了各种<code class=\"language-text\">html</code>静态文件，那首页是如何请求并且渲染出来的呢?</p>\n<p>这要归功于<code class=\"language-text\">play</code>中清晰的路由配置。打开<code class=\"language-text\">/conf</code>中的的<code class=\"language-text\">/routes</code>文件，可以看到，有这样的路由配置：</p>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre class=\"language-scala\"><code class=\"language-scala\">GET           <span class=\"token operator\">/</span>                        controllers<span class=\"token punctuation\">.</span>HomeController<span class=\"token punctuation\">.</span>index\nGET           <span class=\"token operator\">/</span>assets<span class=\"token comment\">/*file            controllers.Assets.versioned(path=\"/public\", file: Asset)</span></code></pre></div>\n<p>很明显，这里请求了<code class=\"language-text\">/</code>根路径，并且对应执行了<code class=\"language-text\">HomeController</code>中的<code class=\"language-text\">index</code>方法。可以在<code class=\"language-text\">/controllers</code>中查看<code class=\"language-text\">HomeController</code>，有如下代码：</p>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre class=\"language-scala\"><code class=\"language-scala\"><span class=\"token keyword\">def</span> index <span class=\"token operator\">=</span> Action <span class=\"token punctuation\">{</span>\n   Ok<span class=\"token punctuation\">(</span>views<span class=\"token punctuation\">.</span>html<span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">(</span><span class=\"token string\">\"My new Play &amp; Scala application is ready.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>可以看到，<code class=\"language-text\">Action</code>中通过<code class=\"language-text\">Ok</code>方法，返回了一个/view中的一个<code class=\"language-text\">html</code>页面。值得注意的是，这里包含了静态资源的路径的配置。指向/public目录。</p>\n<p>这里发现了<code class=\"language-text\">/view/index</code>，其实这里引用的即是<code class=\"language-text\">/view/index.scala.html</code>文件，并且为这个文件传入了一个字符串参数，这样就不难理解<code class=\"language-text\">index.scala.html</code>中变量<code class=\"language-text\">message</code>和<code class=\"language-text\">main.scala.html</code>中的<code class=\"language-text\">title</code>的作用了——当然是接收实参。你也可以自定义很多有用的参数来进行传递，但是唯一要注意的是，对于强类型的语言来说，数据类型一定要相同。</p>\n<p><strong>请求的过程大概是这样的</strong></p>\n<blockquote>\n<p>用户从浏览器中输入URL,浏览器向play发出请求，<code class=\"language-text\">Play</code>在<code class=\"language-text\">routes</code>文件中寻找相应的请求<code class=\"language-text\">URL</code>,找到之后，去执行<code class=\"language-text\">Controllers</code>中的方法,返回一个静态的<code class=\"language-text\">html</code>文件。</p>\n</blockquote>\n<p>但细心可以发现，<code class=\"language-text\">index.scala.html</code>中还包括一个参数。<code class=\"language-text\">{}</code>中的内容。这个可以在<code class=\"language-text\">main.scala.html</code>中找到答案。</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\">//main.scala.html\n\n@(title: String)(content: Html)\n<span class=\"token doctype\">&lt;!DOCTYPE html></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n        @* Here's where we render the page title `String`. *@\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>@title<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n        &lt;link rel=\"stylesheet\" media=\"screen\" href=\"@routes.Assets.versioned(\"stylesheets/main.css\")\">\n        &lt;link rel=\"shortcut icon\" type=\"image/png\" href=\"@routes.Assets.versioned(\"images/favicon.png\")\">\n        &lt;script src=\"@routes.Assets.versioned(\"javascripts/hello.js\")\" type=\"text/javascript\"><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n        @* And here's where we render the `Html` object containing\n         * the page content. *@\n        @content\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>可以看到，除了<code class=\"language-text\">title</code>之外，还有<code class=\"language-text\">content</code>。在这里<code class=\"language-text\">content</code>的作用很明显，而且它的类型为<code class=\"language-text\">Html</code>，可以看出，这里是允许用户写入一段<code class=\"language-text\">html</code>来作为<code class=\"language-text\">content</code>的实参，并且在浏览器会解析<code class=\"language-text\">body</code>中的内容，不会当做<code class=\"language-text\">play</code>的字符串直接处理。这样对代码的模块化很有帮助，比如亘古不变的<code class=\"language-text\">sidebar</code>、<code class=\"language-text\">nav</code>等。</p>\n<hr>\n<h3>实战</h3>\n<p>通过以上的了解，我相信已经对路由的配置，以及静态页面渲染的过程，包括页面传参有了一个大体的了解。既然这样，我们就先来做一个静态页面吧。</p>\n<h4>layout.scala.html</h4>\n<p>可以仿照<code class=\"language-text\">main.scala.html</code>中的内容，来写一个<code class=\"language-text\">layout.scala.html</code>页面，效果像第一篇内容中的截图一样。</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\">//layout.scala.html\n\n@(title: String)(content: Html)\n<span class=\"token doctype\">&lt;!DOCTYPE html></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        &lt;link rel=\"stylesheet\" href=\"@routes.Assets.versioned(\"stylesheets/bootstrap.min.css\")\">\n        &lt;link rel=\"stylesheet\" href=\"@routes.Assets.versioned(\"stylesheets/main.css\")\">\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>@title<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>container<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>h1 h1-margin<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>@title<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>hr</span><span class=\"token punctuation\">/></span></span>\n            @content\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>值得一提的是，这里引用了两个<code class=\"language-text\">css</code>文件。<code class=\"language-text\">play</code>通过<code class=\"language-text\">@</code>来表示是一个<code class=\"language-text\">scala</code>中的变量或者表达式，可以直接通过调用路由中的方法来设置文件的路径和<code class=\"language-text\">a</code>链接中的<code class=\"language-text\">href</code>属性值。</p>\n<h3>users.scala.html</h3>\n<p>可以引用<code class=\"language-text\">layout.scala.html</code>文件作为整个<code class=\"language-text\">html</code>的大体结构，创建<code class=\"language-text\">users.scala.html</code>文件来展示用户列表。</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\">//users.scala.html\n\n@(messages: String)\n@layout(\"Users List\") {\n\n   \t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>POST<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>search<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>form-control pull-left search padding<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>查询<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>btn btn-primary pull-left padding<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>添加<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>table</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>table<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>table table-bordered table-hover table-striped container<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>info<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>th</span><span class=\"token punctuation\">></span></span>#<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>th</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>th</span><span class=\"token punctuation\">></span></span>用户名<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>th</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>th</span><span class=\"token punctuation\">></span></span>描述<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>th</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>th</span><span class=\"token punctuation\">></span></span>密码<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>th</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>th</span><span class=\"token punctuation\">></span></span>操作<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>th</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span><span class=\"token punctuation\">></span></span>\n\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span>\n            ···\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>table</span><span class=\"token punctuation\">></span></span>\n}</code></pre></div>\n<p>这样，静态页面就完成了。</p>\n<h3>routes</h3>\n<p>在<code class=\"language-text\">routes</code>文件中，设置页面的路由。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">GET           /users                   controllers.UserController.list</code></pre></div>\n<h3>UsersController.scala</h3>\n<p>新建<code class=\"language-text\">UsersController.scala</code>,添加<code class=\"language-text\">list</code>方法：</p>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre class=\"language-scala\"><code class=\"language-scala\"><span class=\"token keyword\">def</span> list <span class=\"token operator\">=</span> Action <span class=\"token punctuation\">{</span>\n   Ok<span class=\"token punctuation\">(</span>views<span class=\"token punctuation\">.</span>html<span class=\"token punctuation\">.</span>users<span class=\"token punctuation\">(</span><span class=\"token string\">\"User list\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>结果</h3>\n<p>打开浏览器，访问<a href=\"http://localhost:9000/users\">http://localhost:9000/users</a>,查看页面如下图。</p>\n<p><img src=\"https://camo.githubusercontent.com/5ee38df9cb5155b2d6f2bad5207b65482de1929a/687474703a2f2f696d616765732d6d616e616765722e6f73732d636e2d7368616e676861692e616c6979756e63732e636f6d2f7374617469632f757365726c6973742e706e67\" alt=\"img\"></p>\n<p><strong><em>增删该查页面同列表页。</em></strong></p>","frontmatter":{"title":"快学Scala+Playframework之增删改查——路由与静态页面（二）","date":"October 28, 2016"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/scala-palyframework-curd-2/","previous":{"fields":{"slug":"/scala-palyframework-curd-1/"},"frontmatter":{"title":"快学Scala+Playframework之增删改查——项目搭建（一）"}},"next":{"fields":{"slug":"/json-server-http-request/"},"frontmatter":{"title":"JSON-Server and XMLHttpRequest"}}}}}