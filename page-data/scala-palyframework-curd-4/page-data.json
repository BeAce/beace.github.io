{"componentChunkName":"component---src-templates-blog-post-js","path":"/scala-palyframework-curd-4/","webpackCompilationHash":"1893e940b14bce61c104","result":{"data":{"site":{"siteMetadata":{"title":"Beace Blog","author":"Beace Lee"}},"markdownRemark":{"id":"001736d3-f2c8-551e-9d4f-e9f06ef9ae4e","html":"<h2>目标</h2>\n<ul>\n<li>接上一篇<a href=\"https://beacelee.com/post/scala-playframework-database-mysql.html\">快学Scala+Playframework之增删改查—— 数据库操作（三）</a>,完成其他(添加、查询、修改、删除)等API的操作</li>\n</ul>\n<h2>知识点</h2>\n<ul>\n<li>\n<p>数据库操作</p>\n</li>\n<li>\n<p>列表添加、查询、删除、修改 API的实现</p>\n</li>\n<li>\n<p>查询关键词高亮</p>\n</li>\n</ul>\n<!--more-->\n<hr>\n<h2>添加（新建）的实现</h2>\n<p>在<code class=\"language-text\">/view</code>中新建<code class=\"language-text\">userForm.scala.html</code>,写入基本的表单代码：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">role</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>form<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>@routes.Application.add()<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>post<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>form-group<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n             <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span><span class=\"token punctuation\">></span></span>User name<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n             <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>form-control<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n       <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n       <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>form-group<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n             <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span><span class=\"token punctuation\">></span></span>Description<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n              <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>form-control<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>description<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>description<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n       <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n       <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>form-group<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n             <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span><span class=\"token punctuation\">></span></span>Password<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n             <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>form-control<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Password<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n       <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>btn btn-primary<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Submit<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/users<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>btn btn-info<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>btn btn-primary<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Return<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>在<code class=\"language-text\">/controllers/Application.scala</code>中直接处理来自表单的<code class=\"language-text\">POST</code>请求。</p>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre class=\"language-scala\"><code class=\"language-scala\"><span class=\"token keyword\">def</span> add <span class=\"token operator\">=</span> Action <span class=\"token punctuation\">{</span> <span class=\"token keyword\">implicit</span> request <span class=\"token keyword\">=></span>\n    <span class=\"token comment\">//获取表单中用户填写 (要 POST) 的数据</span>\n    <span class=\"token keyword\">val</span> <span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">,</span> description<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> form<span class=\"token punctuation\">.</span>bindFromRequest<span class=\"token punctuation\">.</span>get\n    db<span class=\"token punctuation\">.</span>withConnection <span class=\"token punctuation\">{</span> <span class=\"token keyword\">implicit</span> c <span class=\"token keyword\">=></span>\n    <span class=\"token comment\">//执行插入操作</span>\n      <span class=\"token keyword\">val</span> result <span class=\"token operator\">=</span> SQL<span class=\"token string\">\"INSERT INTO test(id,username,description,password) VALUES (null,$username,$description,$password)\"</span><span class=\"token punctuation\">.</span>executeInsert<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      Ok<span class=\"token punctuation\">(</span>Json<span class=\"token punctuation\">.</span>obj<span class=\"token punctuation\">(</span>\n        <span class=\"token string\">\"code\"</span> <span class=\"token operator\">-></span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"result\"</span> <span class=\"token operator\">-></span> result\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      Redirect<span class=\"token punctuation\">(</span><span class=\"token string\">\"/users\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>效果如下所示</p>\n<p><img src=\"https://images-manager.oss-cn-shanghai.aliyuncs.com/static/play-scala-userlist/a.gif\" alt=\"add\"></p>\n<hr>\n<h2>查询的实现</h2>\n<p>在页面的头部加入一段查询的<code class=\"language-text\">html</code>代码</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>@routes.Application.search()<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>POST<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n       <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>search<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>form-control pull-left search padding<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>查询<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>在<code class=\"language-text\">/controllers/Application.scala</code>中书写<code class=\"language-text\">search</code>请求方法</p>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre class=\"language-scala\"><code class=\"language-scala\"><span class=\"token keyword\">def</span> search <span class=\"token operator\">=</span> Action <span class=\"token punctuation\">{</span> <span class=\"token keyword\">implicit</span> request <span class=\"token keyword\">=></span>\n    <span class=\"token keyword\">val</span> body <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>body\n    <span class=\"token keyword\">val</span> jsonBody<span class=\"token operator\">:</span> Option<span class=\"token punctuation\">[</span>JsValue<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> body<span class=\"token punctuation\">.</span>asJson\n    <span class=\"token keyword\">val</span> name<span class=\"token operator\">:</span> Option<span class=\"token punctuation\">[</span><span class=\"token builtin\">String</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>asFormUrlEncoded<span class=\"token punctuation\">.</span>flatMap<span class=\"token punctuation\">(</span>m <span class=\"token keyword\">=></span> m<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"username\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>flatMap<span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">.</span>headOption<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">val</span> username <span class=\"token operator\">=</span> name<span class=\"token punctuation\">.</span>getOrElse<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    db<span class=\"token punctuation\">.</span>withConnection <span class=\"token punctuation\">{</span> <span class=\"token keyword\">implicit</span> c <span class=\"token keyword\">=></span>\n      <span class=\"token keyword\">val</span> parser<span class=\"token operator\">:</span> RowParser<span class=\"token punctuation\">[</span>Userinfo<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> Macro<span class=\"token punctuation\">.</span>namedParser<span class=\"token punctuation\">[</span>Userinfo<span class=\"token punctuation\">]</span>\n      <span class=\"token keyword\">val</span> result <span class=\"token operator\">=</span> SQL<span class=\"token punctuation\">(</span>s<span class=\"token string\">\"SELECT * FROM test WHERE username LIKE '%$username%' OR description LIKE '%$username%'\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>as<span class=\"token punctuation\">(</span>parser<span class=\"token punctuation\">.</span>*<span class=\"token punctuation\">)</span>\n      <span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token keyword\">val</span> json <span class=\"token operator\">=</span> Json<span class=\"token punctuation\">.</span>toJson<span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span>\n      <span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token keyword\">val</span> jsonSeq <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>as<span class=\"token punctuation\">[</span>Seq<span class=\"token punctuation\">[</span>Userinfo<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span>\n      Ok<span class=\"token punctuation\">(</span>views<span class=\"token punctuation\">.</span>html<span class=\"token punctuation\">.</span>search<span class=\"token punctuation\">(</span><span class=\"token string\">\"User query\"</span><span class=\"token punctuation\">,</span> jsonSeq<span class=\"token punctuation\">,</span> username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>这里通过获取<code class=\"language-text\">body</code>中的内容，进而查询数据库，可以看到加粗的代码中，先将查询结构转化为<code class=\"language-text\">JSON</code>，进而又转化为<code class=\"language-text\">Seq</code>。这样的做法是为了适配分离。如果需要返回<code class=\"language-text\">json</code>的数据，在前端做请求，可去掉第二行。我这里直接将数据返回给了<code class=\"language-text\">html</code>页面。</p>\n<p>效果如下图所示：</p>\n<p><img src=\"https://images-manager.oss-cn-shanghai.aliyuncs.com/static/play-scala-userlist/f.gif\" alt=\"add\"></p>\n<h3>页面传值</h3>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre class=\"language-scala\"><code class=\"language-scala\">@<span class=\"token punctuation\">(</span>messages<span class=\"token operator\">:</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">,</span> users<span class=\"token operator\">:</span> Seq<span class=\"token punctuation\">[</span>Userinfo<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> keyword<span class=\"token operator\">:</span> <span class=\"token builtin\">Any</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>在这里，我不仅传入了查找到的结果，还讲<code class=\"language-text\">keyword</code>查询的关键字返回。为了显示的方便。并且如果直接在<code class=\"language-text\">html</code>代码中拼接<code class=\"language-text\">scala</code>中的变量，会直接渲染字符而不是我们期待的结果，因此<code class=\"language-text\">PLAY</code>提供了如下方法输出浏览器可解析的<code class=\"language-text\">html</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\">@for(user <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>-</span> <span class=\"token attr-name\">users)</span> <span class=\"token attr-name\">{</span>\n            <span class=\"token attr-name\">&lt;tr</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span>@user.id<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span>\n                @if(user.username.indexOf(keyword) &lt; 0) {\n                    //输出html\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span>@Html(user.username.replaceAll(keyword.toString, \"<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">'</span>keyword<span class=\"token punctuation\">'</span></span><span class=\"token punctuation\">></span></span>\" + keyword + \"<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span>\"))<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span>\n                } else {\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span>@user.username<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span>\n                }\n                @if(user.description.indexOf(keyword) &lt; 0) {\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span>@Html(user.description.replaceAll(keyword.toString, \"<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">'</span>keyword<span class=\"token punctuation\">'</span></span><span class=\"token punctuation\">></span></span>\" + keyword + \"<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span>\"))<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span>\n                } else {\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span>@user.description<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span>\n                }\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span>@user.password<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>@routes.UserController.detail(user.id)<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>详情<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span><span class=\"token style-attr language-css\"><span class=\"token attr-name\"> <span class=\"token attr-name\">style</span></span><span class=\"token punctuation\">=\"</span><span class=\"token attr-value\"><span class=\"token property\">margin</span><span class=\"token punctuation\">:</span> 0 10px<span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>|<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>@routes.UserController.edit(user.id)<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>修改<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span><span class=\"token style-attr language-css\"><span class=\"token attr-name\"> <span class=\"token attr-name\">style</span></span><span class=\"token punctuation\">=\"</span><span class=\"token attr-value\"><span class=\"token property\">margin</span><span class=\"token punctuation\">:</span> 0 10px<span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>|<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>@routes.UserController.delete(user.id)<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>删除<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span>\n        }</code></pre></div>\n<hr>\n<p>删除和修改的实现</p>\n<p>较为简单，这里只记录代码的内容。</p>\n<h4>修改(同添加)</h4>\n<div class=\"gatsby-highlight\" data-language=\"scala\"><pre class=\"language-scala\"><code class=\"language-scala\"><span class=\"token keyword\">def</span> edit<span class=\"token punctuation\">(</span>id<span class=\"token operator\">:</span> <span class=\"token builtin\">Int</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> Action <span class=\"token punctuation\">{</span> <span class=\"token keyword\">implicit</span> request <span class=\"token keyword\">=></span>\n    <span class=\"token keyword\">val</span> <span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">,</span> description<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> form<span class=\"token punctuation\">.</span>bindFromRequest<span class=\"token punctuation\">.</span>get\n    db<span class=\"token punctuation\">.</span>withConnection <span class=\"token punctuation\">{</span> <span class=\"token keyword\">implicit</span> c <span class=\"token keyword\">=></span>\n      <span class=\"token keyword\">val</span> result <span class=\"token operator\">=</span> SQL<span class=\"token string\">\"UPDATE test SET username=$username,description=$description,password=$password WHERE id=$id\"</span><span class=\"token punctuation\">.</span>executeUpdate<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      Ok<span class=\"token punctuation\">(</span>Json<span class=\"token punctuation\">.</span>obj<span class=\"token punctuation\">(</span>\n        <span class=\"token string\">\"result\"</span> <span class=\"token operator\">-></span> result\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      Redirect<span class=\"token punctuation\">(</span><span class=\"token string\">\"/users\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>效果如下图所示</p>\n<p><img src=\"https://images-manager.oss-cn-shanghai.aliyuncs.com/static/play-scala-userlist/e.gif\" alt=\"add\"></p>\n<h4>删除</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  def delete(id: Int) = Action {\n    db.withConnection { implicit c =&gt;\n      val result = SQL(s&quot;DELETE FROM test WHERE id=$id&quot;).executeUpdate()\n      //这里返回了json串标志着删除成功\n      Ok(Json.obj(\n        &quot;code&quot; -&gt; 0,\n        &quot;result&quot; -&gt; result\n      ))\n    }\n    Redirect(&quot;/users&quot;)\n  }</code></pre></div>\n<h2>总结</h2>\n<p>这里算是<code class=\"language-text\">playframework</code>的增删该查的完结篇。通过四篇内容，完整的记录了这个小项目的增删改查的全过程。涵盖了如下知识点：</p>\n<ul>\n<li>\n<p><code class=\"language-text\">playframework</code> 有关知识——框架的搭建、配置、库的安装、数据库的交互、静态页面、API等等</p>\n</li>\n<li>\n<p><code class=\"language-text\">API</code>的认识和写法</p>\n</li>\n<li>\n<p><code class=\"language-text\">scala</code>的基本语法（方法、数据类型、类）</p>\n</li>\n<li>\n<p><code class=\"language-text\">mysql</code>数据库的增删改查操作</p>\n</li>\n</ul>\n<h2>写在后面（未完待续…）</h2>\n<blockquote>\n<p>在后续的过程中，我会陆续搭建更为复杂和完善的应用，比如企业管理系统，数据可视化、注册登录、权限分配、信息导出、导入等操作，并且在前端交互和前后端分离上下大工夫，以及纯<code class=\"language-text\">scala</code>的高级应用。<code class=\"language-text\">play</code>如其名，只是一个玩具框架，更重要的是<code class=\"language-text\">scala</code>语言本身。</p>\n</blockquote>","frontmatter":{"title":"快学Scala+Playframework之增删改查—— 数据库操作（四）","date":"November 14, 2016"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/scala-palyframework-curd-4/","previous":{"fields":{"slug":"/scala-palyframework-curd-3/"},"frontmatter":{"title":"快学Scala+Playframework之增删改查—— 数据库操作（三）"}},"next":{"fields":{"slug":"/markdown-editor/"},"frontmatter":{"title":"最好用的markdown编辑器汇总"}}}}}