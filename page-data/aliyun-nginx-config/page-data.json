{"componentChunkName":"component---src-templates-blog-post-js","path":"/aliyun-nginx-config/","webpackCompilationHash":"1893e940b14bce61c104","result":{"data":{"site":{"siteMetadata":{"title":"Beace Blog","author":"Beace Lee"}},"markdownRemark":{"id":"13764c51-8cad-5231-834f-4ecc8db01b67","html":"<h4>开发环境</h4>\n<p>本地环境 OS X  ECS CentOS7</p>\n<h4>需求描述</h4>\n<p>我需要在<code class=\"language-text\">node</code>环境下开发微信。我的<code class=\"language-text\">node</code>项目跑在<code class=\"language-text\">1234</code>端口上，但是购买的阿里云<code class=\"language-text\">ECS</code>有<code class=\"language-text\">apace</code>和<code class=\"language-text\">nginx</code>服务支持<code class=\"language-text\">80</code>端口。我可以这样访问我的项目，<code class=\"language-text\">beacelee.com:1234</code>，但是哪里有见过域名后面加端口的，而且微信只支持<code class=\"language-text\">80</code>和<code class=\"language-text\">443</code>端口。既然要装逼起来就要懂写服务器配置。因此，将<code class=\"language-text\">1234</code>端口映射到<code class=\"language-text\">80</code>上。</p>\n<!--more-->\n<h4>解决方案1：</h4>\n<p>你可以在你项目根目录下建立一个<code class=\"language-text\">nginx</code>的配置文件，然后软链到你的<code class=\"language-text\">nginx</code>配置目录下。</p>\n<p>例如：在项目目录下新建文件：<code class=\"language-text\">nginx.conf</code>，有以下内容：</p>\n<div class=\"gatsby-highlight\" data-language=\"nginx\"><pre class=\"language-nginx\"><code class=\"language-nginx\"><span class=\"token keyword\">server</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">listen</span> <span class=\"token number\">80</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">server_name</span> lab<span class=\"token punctuation\">.</span>beacelee<span class=\"token punctuation\">.</span>com<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">location</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">root</span> <span class=\"token operator\">/</span>var<span class=\"token operator\">/</span>www<span class=\"token operator\">/</span>html<span class=\"token operator\">/</span>beace<span class=\"token operator\">-</span>blog<span class=\"token operator\">/</span>node_wechat<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">index</span> <span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>html <span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>htm <span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>php\n        <span class=\"token keyword\">proxy_set_header</span>   X<span class=\"token operator\">-</span>Real<span class=\"token operator\">-</span>IP <span class=\"token variable\">$remote_addr</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">proxy_set_header</span>   Host      <span class=\"token variable\">$http_host</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">proxy_pass</span>         <span class=\"token keyword\">http</span><span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span><span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span><span class=\"token punctuation\">:</span><span class=\"token number\">1234</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>很容易看出，项目的根目录为</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">/var/www/beace-blog/node_wechat</code></pre></div>\n<p>而此时映射的node的端口为<code class=\"language-text\">1234</code>，其他的可以忽略先，至少可以从这几个配置项中看出端倪和规律。</p>\n<p>另外，<code class=\"language-text\">node</code>项目可以通过全局安装<code class=\"language-text\">PM2</code>，运行命令：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">pm2 start app.js</code></pre></div>\n<p>来保持服务开启。</p>\n<p>然后通过命令：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">ln</span> -s /var/www/html/beace-blog/node_wechat/nginx.conf /etc/nginx/conf.d/lab.beacelee.com.conf</code></pre></div>\n<p>重启<code class=\"language-text\">nginx</code>：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">systemctl restart nginx.service</code></pre></div>\n<h4>解决方案2：</h4>\n<p>直接修改<code class=\"language-text\">/etc/nginx/conf.d/default.conf</code>,在最下面添加如下内容：</p>\n<p><img src=\"/static/upload/201609/l7sj4AmIih5AZBF1gfiDpp10.png\" alt=\"alt\"></p>\n<p>重启nginx。</p>","frontmatter":{"title":"阿里云域名解析，Nginx二级域名的配置","date":"September 12, 2016"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/aliyun-nginx-config/","previous":{"fields":{"slug":"/github-passport/"},"frontmatter":{"title":"Github中passport的应用（github登录接口）"}},"next":{"fields":{"slug":"/aliyun-nginx-certificates/"},"frontmatter":{"title":"在nginx服务器下配置和安装阿里云购买的SSL证书"}}}}}