{"componentChunkName":"component---src-templates-blog-post-js","path":"/github-passport/","webpackCompilationHash":"aafb099bc401288f620b","result":{"data":{"site":{"siteMetadata":{"title":"Beace Blog","author":"Beace Lee"}},"markdownRemark":{"id":"8f7a0b17-da31-5d6e-93e7-0170f309228b","html":"<p>1、点击头像下拉三角形按钮，进入<code class=\"language-text\">settings</code></p>\n<p><img src=\"/static/upload/201609/3xazQProopGfFmwFvHPxJJb9.jpg\" alt=\"alt\"></p>\n<!--more-->\n<p>2、点击左侧列表按钮中的<code class=\"language-text\">oAuth applications</code></p>\n<p><img src=\"/static/upload/201609/8wrAeCtemdk_e9A_Yp8osbI6.jpg\" alt=\"alt\"></p>\n<p>3、左侧默认显示的你曾经用<code class=\"language-text\">github</code>账号登录过的网站，点击<code class=\"language-text\">developer application</code>，作为开发者应用使用。\n4、依次按照表单提示填写内容，最终会生成<code class=\"language-text\">Client ID</code>和 <code class=\"language-text\">Client Secret</code>。</p>\n<p><img src=\"/static/upload/201609/9zx-WatjFPDiuJ5t3QCeBDzJ.jpg\" alt=\"alt\"></p>\n<p>5、在项目中安装两个模块</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> install：\n\n<span class=\"token string\">\"passport\"</span><span class=\"token keyword\">:</span> <span class=\"token string\">\"*\"</span>,\n<span class=\"token string\">\"passport-github\"</span><span class=\"token keyword\">:</span> <span class=\"token string\">\"*\"</span></code></pre></div>\n<p>6、在入口文件中（app.js） 引入模块：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">//创建用户使用github登录</span>\n<span class=\"token keyword\">var</span> passport <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'passport'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    GithubStrategy <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'passport-github'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Strategy<span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>passport<span class=\"token punctuation\">.</span><span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//初始化</span>\n<span class=\"token comment\">// YOUR ClientID/Secret</span>\npassport<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">GithubStrategy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    clientID<span class=\"token punctuation\">:</span> <span class=\"token string\">\"ClientID\"</span><span class=\"token punctuation\">,</span>\n    clientSecret<span class=\"token punctuation\">:</span> <span class=\"token string\">\"ClientSecret\"</span><span class=\"token punctuation\">,</span>\n    callbackURL<span class=\"token punctuation\">:</span> <span class=\"token string\">\"http://localhost:3000/login/github/callback\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">accessToken<span class=\"token punctuation\">,</span> refreshToken<span class=\"token punctuation\">,</span> profile<span class=\"token punctuation\">,</span> done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> profile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>7、在网络请求中，分配路由，并且把github所登录的账户写入session（默认会在user中）</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">//github login</span>\n    app<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login/github\"</span><span class=\"token punctuation\">,</span> passport<span class=\"token punctuation\">.</span><span class=\"token function\">authenticate</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"github\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>session<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    app<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login/github/callback\"</span><span class=\"token punctuation\">,</span> passport<span class=\"token punctuation\">.</span><span class=\"token function\">authenticate</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"github\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        session<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n        failureRedirect<span class=\"token punctuation\">:</span> <span class=\"token string\">'/login'</span><span class=\"token punctuation\">,</span>\n        successFlash<span class=\"token punctuation\">:</span> <span class=\"token string\">'登陆成功！'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        req<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span>user <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>name<span class=\"token punctuation\">:</span> req<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span>username<span class=\"token punctuation\">,</span> head<span class=\"token punctuation\">:</span> <span class=\"token string\">\"https://gravatar.com/avatar/\"</span> <span class=\"token operator\">+</span> req<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span>_json<span class=\"token punctuation\">.</span>gravatar_id <span class=\"token operator\">+</span> <span class=\"token string\">\"?s=48\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        res<span class=\"token punctuation\">.</span><span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>8、在模板引擎<code class=\"language-text\">ejs</code>文件中加入<code class=\"language-text\">github</code>登录的链接进行测试：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/login/github<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>使用 GitHub 登录<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p><img src=\"/static/upload/201609/kFSFiwtkb7Euc9n9QjPX0oMp.jpg\" alt=\"alt\"></p>","frontmatter":{"title":"Github中passport的应用（github登录接口）","date":"September 12, 2016"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/github-passport/","previous":{"fields":{"slug":"/react-bad-way/"},"frontmatter":{"title":"react的缺点（一）：react中多个component的问题记录"}},"next":{"fields":{"slug":"/aliyun-nginx-config/"},"frontmatter":{"title":"阿里云域名解析，Nginx二级域名的配置"}}}}}