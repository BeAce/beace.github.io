{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog","author":"Kyle Mathews"}},"markdownRemark":{"id":"c39a3b23-bfa2-53cf-8fd6-c17981a8b48c","html":"<hr>\n<p>title: HTML5 dataset 属性不为人知的地方（命名规则和原理）\ndate: Tue Apr 18 2017 15:19:03 GMT+0800 (CST)\nupdated: Tue Apr 18 2017 15:19:27 GMT+0800 (CST)\ncomments: 1\ncategories: js\ntags: [[object Object],[object Object],[object Object]]\npermalink: html5-dataset</p>\n<hr>\n<p><em>HTML5</em>在元素中增加了*data-**，可以允许用户自定义属性。这种可读写的方式极大的方便了\n操作元素时的数据存储、状态保留。经常可以在各大主流网站上面看到它的使用，例如淘宝首页。</p>\n<p><img src=\"https://images-manager.oss-cn-shanghai.aliyuncs.com/static/html5-dataset/14924960637439.jpg\"></p>\n<!--more-->\n<p>下面记录下一些使用细节。</p>\n<h2>语法</h2>\n<p>在语法上，我们可以在任何DOM元素上添加该属性，但是需要遵照一些命名规则。</p>\n<h3>命名规则</h3>\n<ul>\n<li>必须使用<em>data-</em>最为前缀，<em>data-</em>后面数据类型允许<em>字符串</em>，<em>数字</em>，<em>-</em>，<em>.</em>，<em>:</em>，<em>_</em> 。当然了，在使用JavaScript获取时就不能单纯地将一些特殊字符直接点属性使用了。</li>\n</ul>\n<p><img src=\"https://images-manager.oss-cn-shanghai.aliyuncs.com/static/html5-dataset/14924965473433.jpg\"></p>\n<ul>\n<li>不可以使用大写字母。这里说不可以是不太准确的，建议可能更加恰当。但是为了避免出错还是不要使用这种写法，尤其是驼峰式命名。因为获取<em>dataset</em>时，会看到输出的object中该属性都变为了小写。</li>\n</ul>\n<h4>举个例子</h4>\n<p>下面这段代码中加入了自定义属性<em>data-bgColor</em>，采用了驼峰式命名，希望能够记住该属性通过JavaScript动态赋值。</p>\n<div class=\"gatsby-highlight\" data-language=\"html\">\n      <pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>container2<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">data-bgColor</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>yellow<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre>\n      </div>\n<p>可是通过JavaScript获取到该属性时，却变为了小写。如下图。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> container2 <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'container2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> dataset2 <span class=\"token operator\">=</span> container2<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>dataset2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<p><img src=\"https://images-manager.oss-cn-shanghai.aliyuncs.com/static/html5-dataset/14924968409115.jpg\"></p>\n<p>那如果非要使用驼峰式命名该如何呢？上面有个例子举得好像正好规避了这个问题。有这样的一个属性<em>data-name-1</em>，访问到的还是<em>name-1</em>，如果将其换为字符串<em>data-bg-color</em>，可以看到获取的时候就变为了驼峰。</p>\n<p><img src=\"https://images-manager.oss-cn-shanghai.aliyuncs.com/static/html5-dataset/14924973616744.jpg\"></p>\n<p>这是因为浏览器有一个<em>Name conversion（命名转换）</em>的过程，在获取时将<em>data-</em>去掉，并且将之后的命名中如果含有破折号的，将其变为大写。当然了，变为大写的字符也是有范围的。首先它必须具有大写，<em>ASCII</em>中的<em>A</em>到<em>Z</em>。</p>\n<blockquote>\n<p>any dash (U+002D) followed by an ASCII lowercase letter a to z, the dash is removed and the letter is transformed into its uppercase counterpart;</p>\n</blockquote>\n<p>当然了，这是一个双向的过程。我们也可以给DOM元素指定不存在的<em>data-</em>属性。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\">container2<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>itemIndex <span class=\"token operator\">=</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<p>这时，在<em>HTML</em>中，将会如此渲染。如下图，可以看到又加上了破折号<em>data-item-index</em>。</p>\n<p><img src=\"https://images-manager.oss-cn-shanghai.aliyuncs.com/static/html5-dataset/14924980360328.jpg\"></p>\n<blockquote>\n<p>any ASCII uppercase letter A to Z is transformed into a dash followed by its lowercase counterpart;</p>\n</blockquote>\n<h2>操作</h2>\n<p><code class=\"language-text\">JavaScript</code>来获取data-*属性。</p>\n<h3>获取并操作元素样式</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> container <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'container'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> dataset <span class=\"token operator\">=</span> container<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">;</span>\ncontainer<span class=\"token punctuation\">.</span>style <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`\nwidth: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>dataset<span class=\"token punctuation\">.</span>width<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">;\nheight: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>dataset<span class=\"token punctuation\">.</span>height<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">;\nbackground-color: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>dataset<span class=\"token punctuation\">.</span>bgcolor<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">;`</span></span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<p><img src=\"https://images-manager.oss-cn-shanghai.aliyuncs.com/static/html5-dataset/14924987600651.jpg\"></p>\n<h3>也可以在选取特定的元素上起作用。</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> audio <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`audio[data-key=\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>e<span class=\"token punctuation\">.</span>keyCode<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"]`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n      </div>","frontmatter":{"title":"","date":null}}},"pageContext":{"slug":"/2017-04-18-HTML5 dataset 属性不为人知的地方（命名规则和原理）/","previous":{"fields":{"slug":"/2017-04-24-ECMASCRIPT6 -- 碎片化记忆/"},"frontmatter":{"title":""}},"next":{"fields":{"slug":"/2017-03-25-JavaScript Arguments/"},"frontmatter":{"title":""}}}}