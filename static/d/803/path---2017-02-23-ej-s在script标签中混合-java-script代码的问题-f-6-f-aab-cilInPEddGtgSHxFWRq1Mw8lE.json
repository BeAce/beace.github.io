{"data":{"site":{"siteMetadata":{"title":"Beace Blog","author":"Beace Lee"}},"markdownRemark":{"id":"8d1d5efe-73b2-5d01-9d8e-61c108e58825","html":"<h2>背景</h2>\n<p>我在<code class=\"language-text\">node+express</code>项目中定义了一个全局变量<code class=\"language-text\">CONFIG</code>：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\">\n      <pre class=\"language-js\"><code class=\"language-js\">global<span class=\"token punctuation\">.</span><span class=\"token constant\">CONFIG</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  userName<span class=\"token punctuation\">:</span> ‘beace'<span class=\"token punctuation\">,</span>\n  userID<span class=\"token punctuation\">:</span> <span class=\"token string\">'98SDAF99QRWEQ9'</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<!--more-->\n<p>在<code class=\"language-text\">render</code>的时候传入ejs页面中，</p>\n<div class=\"gatsby-highlight\" data-language=\"js\">\n      <pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  app<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token string\">'*'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token constant\">CONFIG</span><span class=\"token punctuation\">)</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token string\">'index'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      title<span class=\"token punctuation\">:</span> “xxx\"<span class=\"token punctuation\">,</span>\n      <span class=\"token constant\">CONFIG</span><span class=\"token punctuation\">:</span> <span class=\"token constant\">CONFIG</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<p>传入完成后，在ejs中想要保留在js代码中，结果发现，每次浏览器都报这个错误</p>\n<div class=\"gatsby-highlight\" data-language=\"html\">\n      <pre class=\"language-html\"><code class=\"language-html\"><span class=\"token doctype\">&lt;!DOCTYPE html></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>utf-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>&lt;%= title %><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/static/dist/stylesheets/main.min.css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script language-javascript\">\n       window<span class=\"token punctuation\">.</span><span class=\"token constant\">CONFIG</span> <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span><span class=\"token operator\">-</span><span class=\"token constant\">CONFIG</span><span class=\"token operator\">%</span><span class=\"token operator\">></span>\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>container<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/static/dist/javascripts/main.min.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script language-javascript\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre>\n      </div>\n<p><img src=\"https://images-manager.oss-cn-shanghai.aliyuncs.com/static/ejs/26291FEB-F820-4CCA-9D92-CC963AFF1F2F.png\"></p>\n<h2>解决方案</h2>\n<p>最终，在<a href=\"http://stackoverflow.com/questions/11289793/accessing-ejs-variable-in-javascript-logic%E4%B8%AD%E6%89%BE%E5%88%B0%E4%BA%86%E7%AD%94%E6%A1%88%E3%80%82\">http://stackoverflow.com/questions/11289793/accessing-ejs-variable-in-javascript-logic中找到了答案。</a></p>\n<p>如果是单个值，可以这样直接赋值，如果是object类型的变量，需要JSON.stringify(CONFIG)来进行一道处理。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\">\n      <pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>name<span class=\"token punctuation\">:</span> <span class=\"token string\">\"beace\"</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">:</span> <span class=\"token string\">\"23423\"</span><span class=\"token punctuation\">}</span>\n<span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n<span class=\"token string\">\"{\"</span>name<span class=\"token string\">\":\"</span>beace<span class=\"token string\">\",\"</span>id<span class=\"token string\">\":\"</span><span class=\"token number\">23423</span><span class=\"token string\">\"}\"</span></code></pre>\n      </div>\n<h3>具体原因如此：</h3>\n<p><code class=\"language-text\">EJS</code>需要解析<code class=\"language-text\">HTML</code>，<code class=\"language-text\">CSS</code>，<code class=\"language-text\">JavaScript</code>，因此应该避免在<code class=\"language-text\">&lt;%%&gt;</code>中出现原生的<code class=\"language-text\">tag</code>。</p>\n<p><img src=\"https://images-manager.oss-cn-shanghai.aliyuncs.com/static/ejs/E7C882B1-6BF4-4CE3-B5EE-27559A4F5B45.png\"></p>","frontmatter":{"title":"EJS在script标签中混合JavaScript代码的问题","date":"Invalid date"}}},"pageContext":{"slug":"/2017-02-23-EJS在script标签中混合JavaScript代码的问题/","previous":{"fields":{"slug":"/2017-02-27-ESLint 的使用/"},"frontmatter":{"title":""}},"next":null}}